var Anchor={init:function(){Anchor.slidey=$(".slidey");Anchor.keys=[];$(window).resize(Anchor.bindResize).trigger("resize");$(window).on("keyup",Anchor.keyup);$(window).on("keydown",Anchor.keydown);Anchor.linky=$(".linky").on("click",Anchor.toggleSlidey);setTimeout(function(){Anchor.hideSlidey();$("body").addClass("js-enabled")},10);$('a[href="#search"]').click(function(){if(!Anchor.linky.hasClass("active")){return Anchor.toggleSlidey.call(Anchor.linky)}})},keyup:function(e){Anchor.keys[e.keyCode]=false},keydown:function(e){Anchor.keys[e.keyCode]=true;if(Anchor.keys[17]&&Anchor.keys[16]&&Anchor.keys[70]){e.preventDefault();Anchor.showSlidey.call(Anchor.linky);$('input[type="search"]').focus()}if(Anchor.keys[27]){e.preventDefault();Anchor.hideSlidey();$('input[type="search"]').blur()}},hideSlidey:function(){Anchor.slidey.css("margin-top",this._slideyHeight);Anchor.linky&&Anchor.linky.removeClass("active");return this},showSlidey:function(){Anchor.slidey.css("margin-top",0);Anchor.linky&&Anchor.linky.addClass("active");return this},toggleSlidey:function(){var e=Anchor;var t=$(this);t.toggleClass("active");e.slidey.css("margin-top",t.hasClass("active")?0:e._slideyHeight);return false},bindResize:function(){Anchor._slideyHeight=-(Anchor.slidey.height()+1);Anchor.hideSlidey()}};$(Anchor.init);$(function(){function E(){var e=document.getElementById("top");e.style.position="absolute";S();T();N();C();M();k(l.offsetWidth,l.offsetHeight);L()}function S(){g=new FSS.WebGLRenderer;y=new FSS.CanvasRenderer;b=new FSS.SVGRenderer;x(s.renderer)}function x(e){if(h){c.removeChild(h.element)}switch(e){case n:h=g;break;case r:h=y;break;case i:h=b;break}h.setSize(l.offsetWidth,l.offsetHeight);c.appendChild(h.element)}function T(){p=new FSS.Scene}function N(){p.remove(d);h.clear();v=new FSS.Plane(e.width*h.width,e.height*h.height,e.segments,e.slices);m=new FSS.Material(e.ambient,e.diffuse);d=new FSS.Mesh(v,m);p.add(d);var t,n;for(t=v.vertices.length-1;t>=0;t--){n=v.vertices[t];n.anchor=FSS.Vector3.clone(n.position);n.step=FSS.Vector3.create(Math.randomInRange(.2,1),Math.randomInRange(.2,1),Math.randomInRange(.2,1));n.time=Math.randomInRange(0,Math.PIM2)}}function C(){var e,n;for(e=p.lights.length-1;e>=0;e--){n=p.lights[e];p.remove(n)}h.clear();for(e=0;e<t.count;e++){n=new FSS.Light(t.ambient,t.diffuse);n.ambientHex=n.ambient.format();n.diffuseHex=n.diffuse.format();p.add(n);n.mass=Math.randomInRange(.5,1);n.velocity=FSS.Vector3.create();n.acceleration=FSS.Vector3.create();n.force=FSS.Vector3.create();n.ring=document.createElementNS(FSS.SVGNS,"circle");n.ring.setAttributeNS(null,"stroke",n.ambientHex);n.ring.setAttributeNS(null,"stroke-width","0.5");n.ring.setAttributeNS(null,"fill","none");n.ring.setAttributeNS(null,"r","10");n.core=document.createElementNS(FSS.SVGNS,"circle");n.core.setAttributeNS(null,"fill",n.diffuseHex);n.core.setAttributeNS(null,"r","4")}}function k(e,t){h.setSize(e,t);FSS.Vector3.set(a,h.halfWidth,h.halfHeight);N()}function L(){o=Date.now()-u;A();O();requestAnimationFrame(L)}function A(){var n,r,i,s,u,l,c,h=e.depth/2;FSS.Vector3.copy(t.bounds,a);FSS.Vector3.multiplyScalar(t.bounds,t.xyScalar);FSS.Vector3.setZ(f,t.zOffset);if(t.autopilot){n=Math.sin(t.step[0]*o*t.speed);r=Math.cos(t.step[1]*o*t.speed);FSS.Vector3.set(f,t.bounds[0]*n,t.bounds[1]*r,t.zOffset)}for(s=p.lights.length-1;s>=0;s--){u=p.lights[s];FSS.Vector3.setZ(u.position,t.zOffset);var d=Math.clamp(FSS.Vector3.distanceSquared(u.position,f),t.minDistance,t.maxDistance);var m=t.gravity*u.mass/d;FSS.Vector3.subtractVectors(u.force,f,u.position);FSS.Vector3.normalise(u.force);FSS.Vector3.multiplyScalar(u.force,m);FSS.Vector3.set(u.acceleration);FSS.Vector3.add(u.acceleration,u.force);FSS.Vector3.add(u.velocity,u.acceleration);FSS.Vector3.multiplyScalar(u.velocity,t.dampening);FSS.Vector3.limit(u.velocity,t.minLimit,t.maxLimit);FSS.Vector3.add(u.position,u.velocity)}for(l=v.vertices.length-1;l>=0;l--){c=v.vertices[l];n=Math.sin(c.time+c.step[0]*o*e.speed);r=Math.cos(c.time+c.step[1]*o*e.speed);i=Math.sin(c.time+c.step[2]*o*e.speed);FSS.Vector3.set(c.position,e.xRange*v.segmentWidth*n,e.yRange*v.sliceHeight*r,e.zRange*h*i-h);FSS.Vector3.add(c.position,c.anchor)}v.dirty=true}function O(){h.render(p);if(t.draw){var e,n,o,u;for(e=p.lights.length-1;e>=0;e--){u=p.lights[e];n=u.position[0];o=u.position[1];switch(s.renderer){case r:h.context.lineWidth=.5;h.context.beginPath();h.context.arc(n,o,10,0,Math.PIM2);h.context.strokeStyle=u.ambientHex;h.context.stroke();h.context.beginPath();h.context.arc(n,o,4,0,Math.PIM2);h.context.fillStyle=u.diffuseHex;h.context.fill();break;case i:n+=h.halfWidth;o=h.halfHeight-o;u.core.setAttributeNS(null,"fill",u.diffuseHex);u.core.setAttributeNS(null,"cx",n);u.core.setAttributeNS(null,"cy",o);h.element.appendChild(u.core);u.ring.setAttributeNS(null,"stroke",u.ambientHex);u.ring.setAttributeNS(null,"cx",n);u.ring.setAttributeNS(null,"cy",o);h.element.appendChild(u.ring);break}}}}function M(){window.addEventListener("resize",P);l.addEventListener("click",_);l.addEventListener("mousemove",D)}function _(e){FSS.Vector3.set(f,e.x,h.height-e.y);FSS.Vector3.subtract(f,a);t.autopilot=!t.autopilot;w.updateDisplay()}function D(e){FSS.Vector3.set(f,e.x,h.height-e.y);FSS.Vector3.subtract(f,a)}function P(e){k(l.offsetWidth,l.offsetHeight);O()}var e={width:1.1,height:2.2,depth:10,segments:12,slices:6,xRange:.8,yRange:.1,zRange:1,ambient:"#555555",diffuse:"#FFFFFF",speed:.002};var t={count:2,xyScalar:1,zOffset:100,ambient:"#3e508f",diffuse:"#5cdbfe",speed:.001,gravity:1200,dampening:.65,minLimit:10,maxLimit:null,minDistance:50,maxDistance:400,autopilot:true,draw:true,bounds:FSS.Vector3.create(),step:FSS.Vector3.create(Math.randomInRange(.2,1),Math.randomInRange(.2,1),Math.randomInRange(.2,1))};var n="webgl";var r="canvas";var i="svg";var s={renderer:r};var o,u=Date.now();var a=FSS.Vector3.create();var f=FSS.Vector3.create();var l=document.getElementById("mesh");var c=document.getElementById("output");var h,p,d,v,m;var g,y,b;var w;if(l){E()}})