var Anchor={init:function(){Anchor.slidey=$(".slidey"),Anchor.keys=[],$(window).resize(Anchor.bindResize).trigger("resize"),$(window).on("keyup",Anchor.keyup),$(window).on("keydown",Anchor.keydown),Anchor.linky=$(".linky").on("click",Anchor.toggleSlidey),setTimeout(function(){Anchor.hideSlidey(),$("body").addClass("js-enabled")},10),$('a[href="#search"]').click(function(){return Anchor.linky.hasClass("active")?void 0:Anchor.toggleSlidey.call(Anchor.linky)})},keyup:function(e){Anchor.keys[e.keyCode]=!1},keydown:function(e){Anchor.keys[e.keyCode]=!0,Anchor.keys[17]&&Anchor.keys[16]&&Anchor.keys[70]&&(e.preventDefault(),Anchor.showSlidey.call(Anchor.linky),$('input[type="search"]').focus()),Anchor.keys[27]&&(e.preventDefault(),Anchor.hideSlidey(),$('input[type="search"]').blur())},hideSlidey:function(){return Anchor.slidey.css("margin-top",this._slideyHeight),Anchor.linky&&Anchor.linky.removeClass("active"),this},showSlidey:function(){return Anchor.slidey.css("margin-top",0),Anchor.linky&&Anchor.linky.addClass("active"),this},toggleSlidey:function(){var e=Anchor,t=$(this);return t.toggleClass("active"),e.slidey.css("margin-top",t.hasClass("active")?0:e._slideyHeight),!1},bindResize:function(){Anchor._slideyHeight=-(Anchor.slidey.height()+1),Anchor.hideSlidey()}};$(Anchor.init),$(function(){function e(){var e=document.getElementById("top");e.style.position="absolute",t(),i(),o(),r(),h(),c(H.offsetWidth,H.offsetHeight),a()}function t(){v=new FSS.WebGLRenderer,w=new FSS.CanvasRenderer,A=new FSS.SVGRenderer,n(z.renderer)}function n(e){switch(y&&W.removeChild(y.element),e){case M:y=v;break;case R:y=w;break;case x:y=A}y.setSize(H.offsetWidth,H.offsetHeight),W.appendChild(y.element)}function i(){g=new FSS.Scene}function o(){g.remove(m),y.clear(),p=new FSS.Plane(k.width*y.width,k.height*y.height,k.segments,k.slices),F=new FSS.Material(k.ambient,k.diffuse),m=new FSS.Mesh(p,F),g.add(m);var e,t;for(e=p.vertices.length-1;e>=0;e--)t=p.vertices[e],t.anchor=FSS.Vector3.clone(t.position),t.step=FSS.Vector3.create(Math.randomInRange(.2,1),Math.randomInRange(.2,1),Math.randomInRange(.2,1)),t.time=Math.randomInRange(0,Math.PIM2)}function r(){var e,t;for(e=g.lights.length-1;e>=0;e--)t=g.lights[e],g.remove(t);for(y.clear(),e=0;e<b.count;e++)t=new FSS.Light(b.ambient,b.diffuse),t.ambientHex=t.ambient.format(),t.diffuseHex=t.diffuse.format(),g.add(t),t.mass=Math.randomInRange(.5,1),t.velocity=FSS.Vector3.create(),t.acceleration=FSS.Vector3.create(),t.force=FSS.Vector3.create()}function c(e,t){y.setSize(e,t),FSS.Vector3.set($,y.halfWidth,y.halfHeight),o()}function a(){u=Date.now()-I,s(),d(),requestAnimationFrame(a)}function s(){var e,t,n,i,o,r,c,a=k.depth/2;for(FSS.Vector3.copy(b.bounds,$),FSS.Vector3.multiplyScalar(b.bounds,b.xyScalar),FSS.Vector3.setZ(C,b.zOffset),b.autopilot&&(e=Math.sin(b.step[0]*u*b.speed),FSS.Vector3.set(C,b.bounds[0]*e,b.bounds[1]+100,b.zOffset)),i=g.lights.length-1;i>=0;i--){o=g.lights[i],FSS.Vector3.setZ(o.position,b.zOffset);var s=Math.clamp(FSS.Vector3.distanceSquared(o.position,C),b.minDistance,b.maxDistance),d=b.gravity*o.mass/s;FSS.Vector3.subtractVectors(o.force,C,o.position),FSS.Vector3.normalise(o.force),FSS.Vector3.multiplyScalar(o.force,d),FSS.Vector3.set(o.acceleration),FSS.Vector3.add(o.acceleration,o.force),FSS.Vector3.add(o.velocity,o.acceleration),FSS.Vector3.multiplyScalar(o.velocity,b.dampening),FSS.Vector3.limit(o.velocity,b.minLimit,b.maxLimit),FSS.Vector3.add(o.position,o.velocity)}for(r=p.vertices.length-1;r>=0;r--)c=p.vertices[r],e=Math.sin(c.time+c.step[0]*u*k.speed),t=Math.cos(c.time+c.step[1]*u*k.speed),n=Math.sin(c.time+c.step[2]*u*k.speed),FSS.Vector3.set(c.position,k.xRange*p.segmentWidth*e,k.yRange*p.sliceHeight*t,k.zRange*a*n-a),FSS.Vector3.add(c.position,c.anchor);p.dirty=!0}function d(){if(y.render(g),b.draw){var e,t,n,i;for(e=g.lights.length-1;e>=0;e--)switch(i=g.lights[e],t=i.position[0],n=i.position[1],z.renderer){case R:y.context.lineWidth=.5;break;case x:t+=y.halfWidth,n=y.halfHeight-n}}}function h(){window.addEventListener("resize",f),H.addEventListener("click",l),H.addEventListener("mousemove",S)}function l(e){FSS.Vector3.set(C,e.x,y.height-e.y),FSS.Vector3.subtract(C,$),b.autopilot=!b.autopilot,V.updateDisplay()}function S(e){FSS.Vector3.set(C,e.x,y.height-e.y),FSS.Vector3.subtract(C,$)}function f(){c(H.offsetWidth,H.offsetHeight),d()}var u,y,g,m,p,F,v,w,A,V,k={width:1.1,height:2.2,depth:10,segments:Math.ceil(window.innerWidth/100),slices:Math.ceil(window.innerWidth/200),xRange:.8,yRange:.1,zRange:1,ambient:"#555555",diffuse:"#FFFFFF",speed:.002},b={count:2,xyScalar:1,zOffset:100,ambient:"#3e508f",diffuse:"#5cdbfe",speed:1e-5,gravity:120,dampening:.65,minLimit:10,maxLimit:null,minDistance:30,maxDistance:60,autopilot:!0,draw:!0,bounds:FSS.Vector3.create(),step:FSS.Vector3.create(Math.randomInRange(1.2,1),Math.randomInRange(1.2,1),Math.randomInRange(1.2,1))},M="webgl",R="canvas",x="svg",z={renderer:R},I=Date.now(),$=FSS.Vector3.create(),C=FSS.Vector3.create(),H=document.getElementById("mesh"),W=document.getElementById("output");H&&e()});
